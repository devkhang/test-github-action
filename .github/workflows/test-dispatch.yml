name: Test Workflow Dispatch

# K√≠ch ho·∫°t th·ªß c√¥ng qua UI, ho·∫∑c t·ª± ƒë·ªông khi push (ƒë·ªÉ test)
on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'M√¥i tr∆∞·ªùng deploy (staging/production)'
        required: true
        default: 'staging'
        type: choice
        options:
          - staging
          - production
  push:
    branches: [main]

jobs:
  test-dispatch:
    name: Run Test with Inputs
    runs-on: ubuntu-latest

    steps:
      # B∆∞·ªõc 1: L·∫•y code repo (b·∫Øt bu·ªôc)
      - name: Checkout Repository
        uses: actions/checkout@v4

      # B∆∞·ªõc 2: Hi·ªÉn th·ªã input t·ª´ workflow_dispatch
      - name: Display Input Values
        run: |
          echo "Environment selected: ${{ github.event.inputs.environment || 'staging' }}"
          echo "Branch: ${{ github.ref_name }}"
          echo "Actor: ${{ github.actor }}"

      # B∆∞·ªõc 3: M√¥ ph·ªèng deploy d·ª±a tr√™n input
      - name: Simulate Deploy
        run: |
          ENV="${{ github.event.inputs.environment || 'staging' }}"
          if [ "$ENV" = "production" ]; then
            echo "üöÄ Deploying to PRODUCTION ‚Äì High risk!"
          else
            echo "üîÑ Deploying to STAGING ‚Äì Safe mode!"
          fi

      # B∆∞·ªõc 4: Ki·ªÉm tra v√† output k·∫øt qu·∫£
      - name: Verify and Output
        id: verify
        run: |
          ENV="${{ github.event.inputs.environment || 'staging' }}"
          echo "deployment_env=$ENV" >> $GITHUB_OUTPUT
          echo "Verification: Workflow dispatched successfully!"

      # B∆∞·ªõc 5: Hi·ªÉn th·ªã output (t√πy ch·ªçn)
      - name: Show Final Output
        run: |
          echo "Final deployment environment: ${{ steps.verify.outputs.deployment_env }}"